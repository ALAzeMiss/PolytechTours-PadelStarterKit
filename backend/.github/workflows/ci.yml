name: Backend CI

on:
	push:
		branches: [ "main" ]
	pull_request:

jobs:
	backend-test:
		runs-on: ubuntu-latest
		strategy:
			matrix:
				python-version: [3.11]

		steps:
			- name: Checkout
				uses: actions/checkout@v4

			- name: Set up Python
				uses: actions/setup-python@v4
				with:
					python-version: ${{ matrix.python-version }}

			- name: Cache pip
				uses: actions/cache@v4
				with:
					path: ~/.cache/pip
					key: ${{ runner.os }}-pip-${{ hashFiles('**/backend/requirements.txt') }}
					restore-keys: |
						${{ runner.os }}-pip-

			- name: Install dependencies
				run: |
					python -m pip install --upgrade pip
					pip install -r backend/requirements.txt

			- name: Run linters (optional)
				run: |
					if [ -f backend/setup.cfg ] || [ -f backend/pyproject.toml ] || [ -f backend/requirements.txt ]; then
						pip install flake8 --quiet || true
						flake8 backend || true
					fi

			- name: Run backend tests
				run: |
					cd backend
					pytest -q --maxfail=1

